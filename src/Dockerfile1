# Use PHP 7.4 with Apache as the base image
FROM php:7.4-apache

# Install mysqli extension
RUN docker-php-ext-install mysqli

# Update database connection strings
# Assuming your connection string is in a file named db-load-script.sql
# RUN sed -i 's/localhost/mysql-service/g' /var/www/html/db-load-script.sql

# Copy the application source code to the container
COPY . /var/www/html/

# These can be overridden when running the container
ENV DB_HOST=mysql-service \
    DB_USER=ecomuser \
    DB_PASSWORD=ecompassword \
    DB_NAME=ecomdb

# Set ServerName directive to suppress the warning
RUN echo "ServerName localhost" >> /etc/apache2/apache2.conf

# Apache already exposes port 80, but we'll make it explicit
EXPOSE 80

# The default command from the base image will start Apache